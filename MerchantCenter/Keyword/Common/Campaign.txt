*** Settings ***
Library           SeleniumLibrary    30    15    run_on_failure=Capture Page Screenshot
Library           String
Library           Collections
Library           OperatingSystem
Library           DateTime
Library           ../PythonLibrary/_customkeyword.py
Resource          ../../Resource/WeMall/WebElement/Campaign.txt

*** Keyword ***
Create Join Campaign
    [Arguments]    ${slug_th}=none   ${join_campaign_type}=1   ${metatags}=none    ${seo_description}=none
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn btn-sm btn-info btn-join-campaign' and contains(text(),'+ Join Campaign')]
    Sleep    1s
    Run keyword if    ${join_campaign_type} == 1    Click Element    //button[contains(text(),'+ ส่วนลด % เดียว และ แบบช่วง')]
    Run keyword if    ${join_campaign_type} == 2    Click Element    //button[contains(text(),'+ สินค้าราคาเดียว และ แบบช่วงราคา')]
    Sleep    1s
    Input Text    //input[@id='campaign_name_th']    [QA-Automate] Join Campaign for SEO
    ${IMG_DIR}=    Replace String Using Regexp    ${CURDIR}    Keyword$    Image
    ${CUR_IMG_DIR}=    Remove String    ${IMG_DIR}    ${/}Keyword${/}Common
    ${file_join_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_banner.jpg
    ${file_join_top_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_top_banner.jpg
    ${file_join_bannermobile}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_m_banner.jpg
    Choose File    id=file_banner    ${file_join_banner}
    Choose File    id=file_topbanner    ${file_join_top_banner}
    Choose File    id=file_bannermobile    ${file_join_bannermobile}
    # Select From List By Index    campaign_group_id    2
    Execute Javascript    $('#description_th_ifr').contents().find('html').html("Join Campaign create campaign by robot script !!");
    Execute Javascript    $("textarea[id='description_th']").text('Join Campaign create campaign by robot script !!')
    Execute Javascript    $("input[name='discount_type']")[1].click()
    Sleep    0.5s
    Run keyword if    ${join_campaign_type} == 1     Input Text    //input[@id='promotion_amount']    1
    Run keyword if    ${join_campaign_type} == 1     Input Text    //input[@id='promotion_amount_end']    5
    Run keyword if    ${join_campaign_type} == 2     Input Text    //input[@id='promotion_amount']    1000
    Run keyword if    ${join_campaign_type} == 2     Input Text    //input[@id='promotion_amount_end']    5000
    Execute Javascript    $('#date_join_campaign').val('01/01/2016 00:00 - 31/12/2018 23:59');
    Execute Javascript    $('#date_show_campaign').val('01/01/2016 00:00 - 31/12/2018 23:59');
    Execute Javascript    $(':contains("ไม่จำกัดจำนวน")').click()
    input text    //input[@id='min_quantity']    3
    Run keyword if    ${join_campaign_type} == 1    input text    //input[@id='price']   2500
    ${default_url}    Execute Javascript    return $('#slug_th').prop('value')
    Should Be True    '${default_url}' == 'qa-automate-join-campaign-for-seo'
    Run Keyword If    '${slug_th}' != 'none'    Input Text    //input[@id='slug_th']    ${slug_th}
    Run Keyword If    '${metatags}' != 'none'    Insert Meta Tags
    Run Keyword if    '${seo_description}' != 'none'    Create Seo description
    Click Element   //button[@class='btn btn-info']
    Sleep    3s
    ${campaign_id}    Get My Campaign ID    join    [QA-Automate] Join Campaign for SEO
    [return]    ${campaign_id}

Create Non Join Campaign
    [Arguments]    ${slug_th}=none    ${metatags}=none    ${seo_description}=none
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn btn-sm btn-info' and contains(text(),'+ Non Join Campaign')]
    Sleep    1s
    Input Text    //input[@id='campaign_name_th']    [QA-Automate] NonJoin Campaign for SEO
    Execute Javascript    $("input[id='campaign_name_th']").val("[QA-Automate] NonJoin Campaign for SEO")
    ${IMG_DIR}=    Replace String Using Regexp    ${CURDIR}    Keyword$    Image
    ${CUR_IMG_DIR}=    Remove String    ${IMG_DIR}    ${/}Keyword${/}Common
    ${file_join_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_banner.jpg
    ${file_join_top_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_top_banner.jpg
    ${file_join_bannermobile}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_m_banner.jpg
    Choose File    id=file_banner    ${file_join_banner}
    Choose File    id=file_topbanner    ${file_join_top_banner}
    Choose File    id=file_bannermobile    ${file_join_bannermobile}
    # Select From List By Index    campaign_group_id    2
    Execute Javascript    $('#date_show_campaign').val('01/01/2016 00:00 - 31/12/2018 23:59');
    Execute Javascript    $('#description_th_ifr').contents().find('html').html("Non Join Campaign Test create by robot script !!");
    Execute Javascript    $("textarea[id='description_th']").text('Non Join Campaign Test create by robot script !!')
    Execute Javascript    $("input[name='order_product']")[1].click()
    Focus    //input[@id="slug_th"]
    ${default_url}    Execute Javascript    return $('#slug_th').prop('value')
    Should Be True    '${default_url}' == 'qa-automate-nonjoin-campaign-for-seo'
    Run Keyword If    '${slug_th}' != 'none'    Input Text    //input[@id='slug_th']    ${slug_th}
    Run Keyword If    '${metatags}' != 'none'    Insert Meta Tags
    Run Keyword if    '${seo_description}' != 'none'    Create Seo description
    Click Element   //button[@class='btn btn-info']
    Sleep    3s
    ${campaign_id}    Get My Campaign ID    non-join    [QA-Automate] NonJoin Campaign for SEO
    [return]    ${campaign_id}

Create WLS Promotion
    [Arguments]    ${slug_th}=none    ${promotion_type}=none    ${metatags}=none
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn btn-sm btn-info' and contains(text(),'+ WLS Promotion')]
    Sleep    1s
    Input Text    //input[@id='campaign_name_th']    [QA-Automate] WLS Promotion campaign for SEO
    ${IMG_DIR}=    Replace String Using Regexp    ${CURDIR}    Keyword$    Image
    ${CUR_IMG_DIR}=    Remove String    ${IMG_DIR}    ${/}Keyword${/}Common
    ${file_join_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_banner.jpg
    ${file_join_top_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_top_banner.jpg
    ${file_join_bannermobile}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    join_m_banner.jpg
    Choose File    id=file_banner    ${file_join_banner}
    Choose File    id=file_topbanner    ${file_join_top_banner}
    Choose File    id=file_bannermobile    ${file_join_bannermobile}
    #Select From List By Index    campaign_group_id    2
    Execute Javascript    $('#description_th_ifr').contents().find('html').html("WLS Promotion Test handle create by robot script !!");
    Execute Javascript    $("textarea[id='description_th']").text('WLS Promotion Test handle create by robot script !!')
    ${current_date}    Get Current Date    UTC    +7 hours    result_format=datetime    exclude_millis=True
    ${current_date_str}    Convert To String    ${current_date}
    ${current_time}    Get Substring    ${current_date_str}    -8
    ${end_date}    Add Time To Date    ${current_date}    1 minutes    exclude_millis=True
    ${end_date_str}    Convert To String    ${end_date}
    ${end_time}    Get Substring    ${end_date_str}    -8
    ${current_date}    Convert Date    ${current_date}    result_format=%d/%m/%Y
    ${campaign_date}    Convert To String    ${current_date}
    ${campaign_date}    Get Substring    ${campaign_date}    \    10
    Execute Javascript    $('#date_show_campaign').val('${campaign_date} ${current_time} - ${campaign_date} ${end_time}');
    Execute Javascript    $("input[name='order_product']")[1].click()
    Run Keyword If    ${promotion_type} == 0    Execute Javascript    $("input[name='promotion_type']")[0].click()
    Run Keyword If    ${promotion_type} == 1    Execute Javascript    $("input[name='promotion_type']")[1].click()
    Run Keyword If    ${promotion_type} == 2    Execute Javascript    $("input[name='promotion_type']")[2].click()
    Focus    //input[@id="slug_th"]
    ${default_url}    Execute Javascript    return $('#slug_th').prop('value')
    Should Be True    '${default_url}' == 'qa-automate-wls-promotion-campaign-for-seo'
    Run Keyword If    '${slug_th}' != 'none'    Input Text    //input[@id='slug_th']    ${slug_th}
    Run Keyword If    '${metatags}' != 'none'    Insert Meta Tags
    Execute Javascript    $('form').submit();
    Sleep    3s
    ${campaign_id}    Get My Campaign ID    promotion    [QA-Automate] WLS Promotion campaign for SEO
    [return]    ${campaign_id}

Get My Campaign ID
    [Arguments]    ${campaign_type}    ${campaign_name}
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign?filter_campaign_type=1
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign?filter_campaign_type=4
    Run Keyword If    '${campaign_type}' == 'promotion'    Go to    ${URL_WMS}/campaign?filter_campaign_type=6
    Input Text    //input[@name='campaign_name']    ${campaign_name}
    Click Element    //button[@class='btn btn-purple btn-sm']
    ${campaign_id}    Get Element Attribute    //tbody//tr[1]@id
    ${campaign_id}    Remove String    ${campaign_id}    row-
    [return]    ${campaign_id}

Delete My Campaign
    [Arguments]    ${campaign_type}    ${campaign_id}
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign?filter_campaign_type=1
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign?filter_campaign_type=4
    Run Keyword If    '${campaign_type}' == 'promotion'    Go to    ${URL_WMS}/campaign?filter_campaign_type=6
    Run Keyword If    '${campaign_type}' == 'join' or '${campaign_type}' == 'promotion'    Click Element    //tbody//tr[@id='row-${campaign_id}']//td[9]//a[3]
    Run Keyword If    '${campaign_type}' == 'non-join'    Click Element    //tbody//tr[@id='row-${campaign_id}']//td[7]//a[3]
    Sleep    1s
    Confirm Action
    Sleep    2s
    Confirm Action

Verify Redirect URL
    [Arguments]    ${site}    ${campaign_id}    ${slug}    ${extra_param}=none
    Log    ${campaign_id}
    Run Keyword If    '${site}' == 'portal' and '${extra_param}' != 'none'    Location Should Be    ${URL_PORTAL}/promotion/${slug}-${campaign_id}${extra_param}
    Run Keyword If    '${site}' == 'mobile' and '${extra_param}' != 'none'    Location Should Be    ${URL_MOBILE}/promotion/${slug}-${campaign_id}${extra_param}
    Run Keyword If    '${site}' == 'portal' and '${extra_param}' == 'none'    Location Should Be    ${URL_PORTAL}/promotion/${slug}-${campaign_id}
    Run Keyword If    '${site}' == 'mobile' and '${extra_param}' == 'none'    Location Should Be    ${URL_MOBILE}/promotion/${slug}-${campaign_id}

Edit Handle Url
    [Arguments]    ${campaign_type}    ${campaign_id}    ${new_slug}
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion'    Go to    ${URL_WMS}/campaign/promotion/edit/${campaign_id}
    Input Text    //input[@id='slug_th']    ${new_slug}
    Execute Javascript    $('form').submit();
    Sleep    3s

Get Group Campaign ID
    [Arguments]     ${campaignid}
    Go to    ${URL_WMS}/campaign/campaign-view/${campaignid}
    ${groupcampignid}    Get Selected List Value    campaign_group_id
    [return]    ${groupcampignid}

Verify Handle URL After Save
    [Arguments]    ${resulthandleurl}    ${campaignid}
    Go to    ${URL_WMS}/campaign/campaign-view/${campaignid}
    ${handleurl}    Get value    //input[@id='slug_th']
    Should Be True    '${handleurl}' == '${resulthandleurl}'

Insert Meta Tags
    Input Text    //input[@id='meta_title_th']    meta title robot test
    Input Text    //input[@id='meta_key_th']    meta keyword robot test
    Input Text    //textarea[@id='meta_des_th']    meta descrition robot robot robot test

Verify Metatags After Save
    [Arguments]    ${campaignid}
    Go to    ${URL_WMS}/campaign/campaign-view/${campaignid}
    Textfield Should contain    //input[@id='meta_title_th']    meta title robot test
    Textfield Should contain    //input[@id='meta_key_th']    meta keyword robot test
    Textarea Should contain    //textarea[@id='meta_des_th']    meta descrition robot robot robot test

Verify Metatags Portal Web Mobile
    [Arguments]    ${siteportal}
    Wait Until Element Is Visible    //div[contains(@class,'-logo')]
    ${title}=    Get Title
    ${description_portal}    Execute Javascript    return $("meta[name='description']").attr('content')
    ${keywords_portal}    Execute Javascript    return $("meta[name='keywords']").attr('content')
    Run Keyword if   '${siteportal}' == 'portal' or '${siteportal}' == 'mobile'    Should Contain Any    ${title}    meta title robot test - Wemall    meta title robot test - Weloveshopping
    Run Keyword if   '${siteportal}' == 'portal'    Should Be True    '${description_portal}' == 'meta descrition robot robot robot test'
    Run Keyword if   '${siteportal}' == 'portal'    Should Be True    '${keywords_portal}' == 'meta keyword robot test'

Edit Meta Tags
    [Arguments]    ${campaign_type}    ${campaign_id}    ${new_metatag}
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion'    Go to    ${URL_WMS}/campaign/promotion/edit/${campaign_id}
    Input Text    //input[@id='meta_title_th']   ${new_metatag}
    Input Text    //input[@id='meta_key_th']    ${new_metatag}
    Input Text    //textarea[@id='meta_des_th']    ${new_metatag}
    Execute Javascript    $('form').submit();
    Sleep    3s

Verify Edit Metatags Portal Web Mobile
    [Arguments]    ${siteportal}
    Run Keyword if   '${siteportal}' == 'mobile'    Wait Until Element Is Visible    //span[@once-text='categoryTitle']
    ${title}    Execute Javascript    return $(document).find("title").text();
    ${description_portal}    Execute Javascript    return $("meta[name='description']").attr('content')
    ${description_mobile}    Execute Javascript    return $("meta[name='description']").text()
    ${keywords_portal}    Execute Javascript    return $("meta[name='keywords']").attr('content')
    Run Keyword if   '${siteportal}' == 'portal' or '${siteportal}' == 'mobile'    Should Be True    '${title}' == 'Edit meta tags robot SEO - Weloveshopping'
    Run Keyword if   '${siteportal}' == 'portal'    Should Be True    '${description_portal}' == 'Edit meta tags robot SEO'
    Run Keyword if   '${siteportal}' == 'portal'    Should Be True    '${keywords_portal}' == 'Edit meta tags robot SEO'
    Run Keyword if   '${siteportal}' == 'mobile'    Should Be True    '${description_mobile}' == 'Edit meta tags robot SEO'

Verify Seo Description
    [Arguments]    ${siteportal}    ${slug}    ${campaign_id}
    Go to     ${URL_PORTAL}/promotion/${slug}-${campaign_id}&refresh=changeme
    Run Keyword if   '${siteportal}' =='portal'    Element Should Be Visible    //*[@id="wrapper"]/div[3]/div[3]
    Run Keyword if   '${siteportal}' =='mobile'    Element Should Not Be Visible    //*[@id="wrapper"]/div[3]/div[3]

Verify Seo Description Dealzapp
    [Arguments]    ${siteportal}
    Run Keyword if   '${siteportal}' =='portal'    Element Should Be Visible    //*[@id="wrapper"]/div[3]/div[3]
    Run Keyword if   '${siteportal}' =='mobile'    Element Should Not Be Visible    //*[@id="wrapper"]/div[3]/div[3]

Edit Seo Description
    [Arguments]    ${campaign_type}    ${campaign_id}     ${file_name}
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion'    Go to    ${URL_WMS}/campaign/promotion/edit/${campaign_id}
    Execute Javascript    $('#mceu_105 > button').click()
    Sleep    1s
    ${file_path}=    Replace String Using Regexp    ${CURDIR}    Keyword$    Image
    ${file_path}=    Remove String    ${file_path}    ${/}Keyword${/}Common
    ${file_path}=    Catenate    SEPARATOR=${/}    ${file_path}${/}Resource/${BU}${/}Configuration${/}${ENV}    ${file_name}
    ${html_desicription}    Get File    ${file_path}
    Focus    //*[@class="mce-textbox mce-multiline mce-abs-layout-item mce-first mce-last"]
    Clear Element Text    //*[@class="mce-textbox mce-multiline mce-abs-layout-item mce-first mce-last"]
    Execute Javascript    $("textarea[class='mce-textbox mce-multiline mce-abs-layout-item mce-first mce-last']").val('${html_desicription}')
    Focus    //*[@class="mce-textbox mce-multiline mce-abs-layout-item mce-first mce-last"]
    Execute Javascript    $('button:contains(Ok)').click()
    Execute Javascript    $('form').submit();

Verify Edit Seo Description
    [Arguments]    ${siteportal}    ${slug}    ${campaign_id}
    Go to     ${URL_PORTAL}/promotion/${slug}-${campaign_id}&refresh=changeme
    Run Keyword if   '${siteportal}' =='portal'    Element Should Be Visible    //*[@id="wrapper"]/div[3]/div[3]
    Element Should Contain    //*[@id="wrapper"]/div[3]/div[3]/div/p/span    แก้ไข SEO

WMS Edit Campaign
    [Documentation]    WMS Edit Campaign
    [Arguments]    ${campaign_type}    ${campaign_id}    ${edit_type}    ${edit_value}
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion'    Go to    ${URL_WMS}/campaign/promotion/edit/${campaign_id}
    Sleep    2s
    Run Keyword If    '${edit_type}' == 'on-off' and '${edit_value}' == 'ON'    Execute Javascript    $("input[name='campaign_status']")[0].click()
    Run Keyword If    '${edit_type}' == 'on-off' and '${edit_value}' == 'OFF'    Execute Javascript    $("input[name='campaign_status']")[1].click()
    Run Keyword If    '${edit_type}' == 'hide-show' and '${edit_value}' == 'SHOW'    Execute Javascript    $("input[name='campaign_show']")[0].click()
    Run Keyword If    '${edit_type}' == 'hide-show' and '${edit_value}' == 'HIDE'    Execute Javascript    $("input[name='campaign_show']")[1].click()
    Execute Javascript    $('.btn.btn-info').click()
    Sleep    2s

Edit Campaign
    [Documentation]    Edit Campaign
    [Arguments]    ${campaign_id}=none    ${campaign_type}=none    ${edit_type}=none
    Delete All Cookies
    WMS Login
    #BuyerKeyword.Go to WMS
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'nonejoin'    Go to    ${URL_WMS}/campaign/collection-non-join/edit/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion'    Go to    ${URL_WMS}/campaign/promotion/edit/${campaign_id}
    Sleep    3s
    # Run Keyword If    '${campaign_type}' == 'promotion' and '${edit_type}'=='ON' and '${BROWSER}' == 'gc' or '${campaign_type}' == 'promotion' and '${edit_type}'=='On-Time' and '${BROWSER}' == 'gc'    Execute Javascript    $('.col-xs-8.col-sm-6').eq(0).find('label').eq(0).find('input').val("3")
    # Run Keyword If    '${campaign_type}' == 'promotion' and '${edit_type}'=='ON' and '${BROWSER}' == 'gc' or '${campaign_type}' == 'promotion' and '${edit_type}'=='On-Time' and '${BROWSER}' == 'gc'    Log To Console    Force radio value manual was execute !!!
    Run Keyword If    '${edit_type}'=='OFF'    Click Element    //div[@class='col-xs-12 col-sm-12']//div[@class='form-group'][1]//div//label[2]
    Run Keyword If    '${edit_type}'=='ON' or '${edit_type}'=='On-Time' or '${edit_type}'=='Hide'    Click Element    //div[@class='col-xs-12 col-sm-12']//div[@class='form-group'][1]//div//label[1]
    Capture Page Screenshot
    # Run Keyword If    '${campaign_id}' == '${promotion_item_for_edit_id}'    Force Value To Promotion By Item
    # Run Keyword If    '${campaign_id}' == '${promotion_cart_price_for_edit_id}'    Force Value To Promotion By Cart
    Run Keyword If    '${edit_type}'=='Hide'    Click Element    //*[@id="edit-basic"]/div[1]/div[2]/div[3]/div/label[2]
    Run Keyword If    '${edit_type}'=='Expire'    Execute Javascript    $('#date_show_campaign').val('01/01/2017 10:00 - 31/12/2017 09:59');
    Run Keyword If    '${edit_type}'=='On-Time'    Execute Javascript    $('#date_show_campaign').val('01/01/2018 10:00 - 31/12/2018 09:59');
    Sleep    0.5s
    ${value_on}    Execute Javascript    return $("input[name='campaign_status']")[0].value
    ${value_off}    Execute Javascript    return $("input[name='campaign_status']")[1].value
    Log To Console    ${\n}Value ON : ${value_on} / Value OFF : ${value_off}
    Click Element    //button[@class='btn btn-info']
    Capture Page Screenshot
    ${off_status}    Execute Javascript    return $("input[name='campaign_status']").eq(1).is(':checked')
    Log To Console    ${\n}Campaign is OFF :: ${off_status}
    Sleep    2


Set Price Product To Campaign
    [Documentation]    Set price product to campaign
    [Arguments]    ${campaign_type}=none    ${campaign_id}=none    ${product_id}=none    ${product_limit}=0    ${custom_price}=${EMPTY}    ${duplicate_period}=No
    WMS Login
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion' or '${campaign_type}' == 'promotion_type3'    Go to    ${URL_WMS}/campaign/promotion/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'dealzapp'    Go to    ${URL_WMS}/campaign/dealzapp/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'knockprice'    Go to    ${URL_WMS}/campaign/collection-price-break/manage-show/${campaign_id}
    Sleep    2s
    ${length}    Execute Javascript    return $('tbody[id="list_product_promotion"] tr').length
    : FOR    ${i}    IN RANGE    1    ${length}
    \    Input Text    //tbody[@id="list_product_promotion"]//tr[${i}]//td[8]//input    199
    Click Element    //div[@class="alert alert-warning ng-scope"]//button[@class="btn btn-warning navbar-btn ng-binding"]
    # Click Element    $('.btn.btn-warning.navbar-btn.ng-binding').click()


WMS Select Product to Campaign
    [Documentation]    WMS Select Product to Campaign
    [Arguments]    ${campaign_type}=none    ${campaign_id}=none    ${product_id}=none    ${product_limit}=0    ${custom_price}=${EMPTY}    ${duplicate_period}=No
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion' or '${campaign_type}' == 'promotion_type3'    Go to    ${URL_WMS}/campaign/promotion/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'dealzapp'    Go to    ${URL_WMS}/campaign/dealzapp/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'knockprice'    Go to    ${URL_WMS}/campaign/collection-price-break/manage-show/${campaign_id}
    Sleep    2s
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='productMsg']    60s
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='showInCampaignMsg']    60s
    ${CheckProduct}    Get Matching Xpath Count    //tbody[@id="list_product_promotion"]//tr[td[3]//a[contains(@href,'${product_id}')]]//i
    Run Keyword If    ${CheckProduct} != 0    Click Element    //tbody[@id="list_product_promotion"]//tr[td[3]//a[contains(@href,'${product_id}')]]//i
    Execute Javascript    $("input[name='txt_search_product']").val('${product_id}')
    Wait Until Element Is Visible    //input[@name='txt_search_product']
    Press Key    //input[@name='txt_search_product']    \\13
    Wait Until Page Contains Element    //tr/td/a[contains(@href,'${product_id}')]    10s
    ${Get_PName}    Get Text    //a[contains(@href,'${product_id}')]
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='productMsg']    60s
    Execute Javascript    $('.all_check.ng-pristine.ng-untouched.ng-valid')[0].click()
    Click Element    //button[@class='btn btn-sm btn-primary pull-right']
    Sleep    3s
    Run Keyword If    '${campaign_type}'=='join' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[10]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='non-join' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[10]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='dealzapp' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[9]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='promotion' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[10]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='promotion_type3' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[9]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='dealzapp' and '${custom_price}'!='${EMPTY}'    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[8]//input    ${custom_price}
    Run Keyword If    '${campaign_type}'=='promotion_type3' and '${custom_price}'!='${EMPTY}'    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[8]//input    ${custom_price}
    Execute Javascript    $('.btn.btn-warning.navbar-btn.ng-binding').click()
    Wait Until Element Is Visible    //div[@class='alert alert-success ng-scope']
    Run Keyword If    '${duplicate_period}' == 'Yes'    Wait Until Element Is Visible    //div[@class='alert alert-warning ng-scope']
    Run Keyword If    '${duplicate_period}' == 'Yes'    Run Keywords    Element Should Be Visible    //div[@class='alert alert-warning ng-scope']
    ...    AND    Element Should Contain    //div[@class='alert alert-warning ng-scope']    มีสินค้าบางรายการไม่สามารถเข้าร่วม promotion ได้ เนื่องจากเข้าร่วมกับ promotion อื่น
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='showInCampaignMsg']    60s
    Sleep    3s
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='showInCampaignMsg']
    Set Test Variable    ${Get_PName}

WMS Select Product to Campaign Check All
    [Documentation]    WMS Select Product to Campaign Check All
    [Arguments]    ${campaign_type}=none    ${campaign_id}=none    ${product_id}=none    ${product_limit}=0    ${custom_price}=${EMPTY}    ${duplicate_period}=No
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'promotion' or '${campaign_type}' == 'promotion_type3'    Go to    ${URL_WMS}/campaign/promotion/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'dealzapp'    Go to    ${URL_WMS}/campaign/dealzapp/manage-show/${campaign_id}
    Run Keyword If    '${campaign_type}' == 'knockprice'    Go to    ${URL_WMS}/campaign/collection-price-break/manage-show/${campaign_id}
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='productMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='showInCampaignMsg']
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='productMsg']
    Execute Javascript    $('.all_check.ng-pristine.ng-untouched.ng-valid')[0].click()
    Click Element    //button[@class='btn btn-sm btn-primary pull-right']
    Sleep    3s
    Run Keyword If    '${campaign_type}'=='join' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[10]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='non-join' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[10]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='dealzapp' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[9]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='promotion' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[10]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='promotion_type3' and ${product_limit} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[9]//input    ${product_limit}
    Run Keyword If    '${campaign_type}'=='dealzapp' and '${custom_price}'!='${EMPTY}'    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[8]//input    ${custom_price}
    Run Keyword If    '${campaign_type}'=='promotion_type3' and '${custom_price}'!='${EMPTY}'    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[8]//input    ${custom_price}
    Execute Javascript    $('.btn.btn-warning.navbar-btn.ng-binding').click()
    Wait Until Element Is Visible    //div[@class='alert alert-success ng-scope']
    Run Keyword If    '${duplicate_period}' == 'Yes'    Wait Until Element Is Visible    //div[@class='alert alert-warning ng-scope']
    Run Keyword If    '${duplicate_period}' == 'Yes'    Run Keywords    Element Should Be Visible    //div[@class='alert alert-warning ng-scope']
    ...    AND    Element Should Contain    //div[@class='alert alert-warning ng-scope']    มีสินค้าบางรายการไม่สามารถเข้าร่วม promotion ได้ เนื่องจากเข้าร่วมกับ promotion อื่น
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='showInCampaignMsg']

Remove Product from Campaign
    [Documentation]    Remove Product from Campaign
    [Arguments]    ${campaign_id}=none    ${product}=none    ${type}=none
    Run Keyword If    '${type}' == 'promotion' or '${type}' == 'promotion_type3'    Go to    ${URL_WMS}/campaign/promotion/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'dealzapp'    Go to    ${URL_WMS}/campaign/dealzapp/manage-show/${campaign_id}
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='productMsg']    ${EXPECT_LOADTIME}
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='showInCampaignMsg']    ${EXPECT_LOADTIME}
    ${found_product}    Run Keyword and Return Status    Element Should Be Visible    //*[@id="list_product_promotion"]//tr/td/a[contains(@href,"${product}")]    ${EXPECT_LOADTIME}
    Run Keyword If    '${found_product}' == 'True'    Click Element    //tr[td[a[contains(@href,"${product}")]]]//i[@class="ace-icon fa fa-times"]
    Run Keyword If    '${found_product}' == 'True'    Execute Javascript    $('.btn.btn-warning.navbar-btn.ng-binding').click()    #button save
    Run Keyword If    '${found_product}' == 'True'    Wait Until Element Is Visible    //div[@class="alert alert-success ng-scope"]    30
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='showInCampaignMsg']    10s
    Check Remove Product From Campaign Success    ${campaign_id}    ${product}    ${type}

Remove Product from Campaign All
    [Documentation]    Remove Product from Campaign All
    [Arguments]    ${campaign_id}=none    ${product}=none    ${type}=none
    Run Keyword If    '${type}' == 'promotion' or '${type}' == 'promotion_type3'    Go to    ${URL_WMS}/campaign/promotion/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'non-join'    Go to    ${URL_WMS}/campaign/collection-non-join/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'dealzapp'    Go to    ${URL_WMS}/campaign/dealzapp/manage-show/${campaign_id}
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='productMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='showInCampaignMsg']
    Execute Javascript    $('.all_check.ng-pristine.ng-untouched.ng-valid')[1].click()
    Click Element    //button[@class='btn btn-sm btn-danger' and contains(text(),'Move Back')]
    Execute Javascript    $('.btn.btn-warning.navbar-btn.ng-binding').click()
    Sleep    3s
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='showInCampaignMsg']    60s

Change limit join campaign
    [Documentation]    Change limit join campaign
    [Arguments]    ${limit}=2
    Execute Javascript    $('input[id="product_limit_2"]').click();
    Input Text    //input[@id='product_limit_input']    ${limit}
    Click Button Submit Campaign

Verify Limit JoinCampaign
    [Documentation]    Verify Limit JoinCampaign
    [Arguments]    ${limit}
    ${get_limit}=    Get Value    //input[@id='product_limit_input']
    Should Be True    ${limit} == ${get_limit}

Checked Campaign Status
    [Documentation]    Checked Campaign Status
    [Arguments]    ${element_status}
    Click Element    ${element_status}
    Set Test Variable    ${campaign_status}    ${element_status}

Checked Campaign Show
    [Documentation]    Checked Campaign Show
    [Arguments]    ${element_show}
    Click Element    ${element_show}
    Set Test Variable    ${campaign_show}    ${element_show}

Get CampaignID
    [Documentation]    Get CampaignID
    [Arguments]    ${url}
    ${loc}    Get Location
    ${getID}=    Remove String    ${loc}    ${url}
    Set Test Variable    ${campaignID}    ${getID}

Get Campaign Name
    [Documentation]    Get Campaign Name
    ${compaign_name_th}    Execute Javascript    return $('#campaign_name_th').val()
    Set Test Variable    ${compaign_name_th}    ${compaign_name_th}

Input Campaign Name TH
    [Documentation]    Input Campaign Name TH
    [Arguments]    ${compaign_name_th}
    Genarate Date
    ${campaign_name_th}    Catenate    ${compaign_name_th} ${getDateTime}
    Execute JavaScript    $('#campaign_name_th').val('${campaign_name_th}')
    Set Test Variable    ${campaign_name_th}    ${campaign_name_th}

Choose Campaign Banner
    [Documentation]    Choose Campaign Banner
    [Arguments]    ${file_name1}    ${file_name2}    ${file_name3}
    ${IMG_DIR}=    Replace String Using Regexp    ${CURDIR}    Keyword$    Image
    ${CUR_IMG_DIR}=    Remove String    ${IMG_DIR}    ${/}Keyword${/}Common
    ${file_join_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    ${file_name1}
    ${file_top_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    ${file_name2}
    ${file_m_banner}=    Catenate    SEPARATOR=${/}    ${CUR_IMG_DIR}${/}Resource/${BU}${/}Image    ${file_name3}
    Choose File    id=file_banner    ${file_join_banner}
    Choose File    id=file_topbanner    ${file_top_banner}
    Choose File    id=file_bannermobile    ${file_m_banner}

Input Campaign Description
    [Documentation]    Input Campaign Description
    Select Frame    id=description_th_ifr
    Input Text    //body[@id='tinymce']    Campaign create by robot script !!
    Unselect Frame

Input handle URL TH
    [Documentation]    Input handle URL TH
    Execute Javascript    $('#slug_th').val('test handel url th')

Input Date Join Campaign
    [Documentation]    Input Date Join Campaign
    [Arguments]    ${date}
    Genarate Date
    ${date_join_campaign}    Catenate    ${date} 00:00 - ${date} 23:59
    Execute Javascript    $('#date_join_campaign').val('${date_join_campaign}')
    Set Test Variable    ${date_join_campaign}    ${date_join_campaign}

Input Date Show Campaign
    [Documentation]    Input Date Show Campaign
    [Arguments]    ${date}
    Genarate Date
    ${date_show_campaign}    Catenate    ${date} 00:00 - ${date} 23:59
    Execute Javascript    $('#date_show_campaign').val('${date_show_campaign}')
    Set Test Variable    ${date_show_campaign}    ${date_show_campaign}

Click Button Submit Campaign
    [Documentation]    Click Button Submit Campaign
    Execute Javascript    $('.btn-info').click()
    Sleep    3s

List Campaign - Get Last Campaign Name
    [Documentation]    List Campaign - Get Last Campaign Name
    ${result}=    Get Text    //*[@id="sample-table-2"]/tbody/tr[1]/td[3]
    Should Contain    ${result}    ${campaign_name_th}

List Campaign - Get Last Campaign Type
    [Documentation]    List Campaign - Get Last Campaign Type
    [Arguments]    ${campaign_type}
    ${result}=    Get Text    //*[@id="sample-table-2"]/tbody/tr[1]/td[6]
    Should Contain    ${result}    ${campaign_type}

List Campaign - Click Icon Edit Last Campaign
    [Documentation]    List Campaign - Click Icon Edit Last Campaign
    Execute Javascript    $('.fa-pencil').eq(0).click()

List Campaign - Click Icon Delete Campaign
    [Documentation]    List Campaign - Click Icon Delete Campaign
    [Arguments]    ${element_del}
    Click Element    ${element_del}
    Sleep    1s
    Confirm Action
    Sleep    5s
    Confirm Action

Verify Campaign Name TH
    [Documentation]    Verify Campaign Name TH
    ${result}    Execute Javascript    return $('#campaign_name_th').val()
    Should Contain    ${result}    ${campaign_name_th}

Verify Date Join Compaign
    [Documentation]    Verify Date Join Compaign
    ${result}    Execute Javascript    return $('#date_join_campaign').val()
    Should Contain    ${result}    ${date_join_campaign}

Verify Date Show Compaign
    [Documentation]    Verify Date Show Compaign
    ${result}    Execute Javascript    return $('#date_show_campaign').val()
    Should Contain    ${result}    ${date_show_campaign}

Verify Handle URL TH
    [Documentation]    Verify Handle URL TH
    ${result}    Execute Javascript    return $('#slug_th').val()
    Should Contain    ${result}    test-handel-url-th

Verify Campaign Portal
    [Documentation]    Verify Campaign Portal
    [Arguments]    ${keyword}    ${locator}
    @{ITEMS}    Create List    @{3_times}
    : FOR    ${ELEMENT}    IN    @{ITEMS}
    \    Sleep    3s
    \    ${result}    ${status}=    Run Keyword And Ignore Error    ${keyword}    ${locator}
    \    Run Keyword If    '${result}' == 'FAIL'    Reload Page
    \    Run Keyword If    '${result}' == 'PASS'    Exit For Loop

Checked Campaign Fee
    [Documentation]    Checked Campaign Fee
    [Arguments]    ${element_fee}    ${price_fee}=none
    Click Element    ${element_fee}
    Run Keyword If    '${price_fee}'!='none'    Input Text    ${input_price_fee}    ${price_fee}
    Set Test Variable    ${campaign_fee}    ${element_fee}

Genarate Date
    [Documentation]    Genarate Date
    ## Get Current Date
    ${yyyy}=    Get Time    year    NOW
    ${mm}=    Get Time    month    NOW
    ${dd}=    Get Time    day    NOW
    ${cur_date}=    Set Variable    ${dd}/${mm}/${yyyy}
    Set Test Variable    ${cur_date}    ${cur_date}
    ## Get Yesterday
    ${getDateTime}    Get Time
    ${yesterday}=    Subtract Time From Date    ${getDateTime}    1 days
    ${datetime}=    Convert Date    ${yesterday}    datetime
    ${year}    Convert To String    ${datetime.year}
    ${month}    Convert To String    ${datetime.month}
    ${day}    Convert To String    ${datetime.day}
    Fill Digit Zero Of The Month    ${month}
    Fill Digit Zero Of The Day    ${day}
    ${yt_date}=    Set Variable    ${day}/${month}/${year}
    Set Test Variable    ${yt_date}    ${yt_date}
    Set Test Variable    ${getDateTime}    ${getDateTime}

Fill Digit Zero Of The Month
    [Documentation]    Fill Digit Zero Of The Month
    [Arguments]    ${month}
    ${month}=    Convert To Integer    ${month}
    ${month}=    Fill Digit Of The Month    ${month}
    Set Test Variable    ${month}    ${month}

Fill Digit Zero Of The Day
    [Documentation]    Fill Digit Zero Of The Day
    [Arguments]    ${day}
    ${day}=    Convert To Integer    ${day}
    ${day}=    Fill Digit Of The Day    ${day}
    Set Test Variable    ${day}    ${day}

Click Button Add Campaign
    [Documentation]    Click Button Add Campaign
    [Arguments]    ${element_type_campaign}    ${expected_url}
    Click Element    ${element_type_campaign}
    Location Should Be    ${expected_url}

Checked Promotion Type
    [Documentation]    Checked Promotion Type
    [Arguments]    ${element_promotion_type}
    Click Element    ${element_promotion_type}
    Set Test Variable    ${promotion_type}    ${element_promotion_type}

Checked Discount Type
    [Documentation]    Checked Discount Type
    [Arguments]    ${element_discount_type}
    Execute JavaScript    ${element_discount_type}.click()
    Set Test Variable    ${discount_type}    ${element_discount_type}

Input Price of discount
    [Documentation]    Input Price of discount
    [Arguments]    ${price_of_discount}
    Execute Javascript    $('#promotion_amount').val('${price_of_discount}')
    Set Test Variable    ${price_of_discount}    ${price_of_discount}

Input Price of product
    [Documentation]    Input Price of product
    [Arguments]    ${price_of_product}
    Execute Javascript    $('#price').val('${price_of_product}')
    Set Test Variable    ${price_of_product}    ${price_of_product}

Input Minimum quantity of product
    [Documentation]    Input Minimum quantity of product
    [Arguments]    ${quantity}
    Execute Javascript    $('#min_quantity').val('${quantity}')
    Set Test Variable    ${min_quantity}    ${quantity}

Input WLS Promotion Date
    ${current_date}    Get Current Date    UTC    +7 hours    result_format=datetime    exclude_millis=True
    ${current_date_str}    Convert To String    ${current_date}
    ${current_time}    Get Substring    ${current_date_str}    -8
    ${current_time}    Get Substring    ${current_time}    0    5
    ${end_date}    Add Time To Date    ${current_date}    1 minutes    exclude_millis=True
    ${end_date_str}    Convert To String    ${end_date}
    ${end_time}    Get Substring    ${end_date_str}    -8
    ${end_time}    Get Substring    ${end_time}    0    5
    ${current_date}    Convert Date    ${current_date}    result_format=%d/%m/%Y
    ${campaign_date}    Convert To String    ${current_date}
    ${campaign_date}    Get Substring    ${campaign_date}    \    10
    Execute Javascript    $('#date_join_campaign').val('${campaign_date} ${current_time} - ${campaign_date} ${end_time}');
    Execute Javascript    $('#date_show_campaign').val('${campaign_date} ${current_time} - ${campaign_date} ${end_time}');
    ${date_join_campaign}    Catenate    ${campaign_date}    ${current_time}    -     ${campaign_date}    ${end_time}
    Set Test Variable    ${date_join_campaign}    ${date_join_campaign}
    Set Test Variable    ${date_show_campaign}    ${date_join_campaign}

Get Promotion ID
    [Arguments]    ${campaign_name}
    Go to    ${URL_WMS}/campaign?filter_campaign_type=6
    Input Text    //input[@name='campaign_name']    ${campaign_name}
    Click Element    //button[@class='btn btn-purple btn-sm']
    ${campaign_id}    Get Element Attribute    //tbody//tr[1]@id
    ${campaign_id}    Remove String    ${campaign_id}    row-
    [return]    ${campaign_id}

Get JoinCampaign ID
    [Arguments]    ${campaign_name}
    Go to    ${URL_WMS}/campaign?filter_campaign_type=1
    Input Text    //input[@name='campaign_name']    ${campaign_name}
    Click Element    //button[@class='btn btn-purple btn-sm']
    ${campaign_id}    Get Element Attribute    //tbody//tr[1]@id
    ${campaign_id}    Remove String    ${campaign_id}    row-
    [return]    ${campaign_id}

Get NonJoinCampaign ID
    [Arguments]    ${campaign_name}
    Go to    ${URL_WMS}/campaign?filter_campaign_type=4
    Input Text    //input[@name='campaign_name']    ${campaign_name}
    Click Element    //button[@class='btn btn-purple btn-sm']
    ${campaign_id}    Get Element Attribute    //tbody//tr[1]@id
    ${campaign_id}    Remove String    ${campaign_id}    row-
    [return]    ${campaign_id}

Delete Robot Campaign
    Go to    ${URL_WMS}/campaign?filter_campaign_type=6
    Input Text    //input[@name='campaign_name']    QA-Robot
    Select From List By Label    id=status    Expired
    Click Element    //button[@class='btn btn-purple btn-sm']
    Sleep    1s
    ${result}    Execute Javascript    return $('#sample-table-2 > tbody > tr').length
    Run Keyword If    ${result} != 1    Confirm Delete Campaign
    Go to    ${URL_WMS}/campaign?filter_campaign_type=1
    Input Text    //input[@name='campaign_name']    QA-Robot
    Click Element    //button[@class='btn btn-purple btn-sm']
    Sleep    1s
    ${result}    Execute Javascript    return $('#sample-table-2 > tbody > tr').length
    Run Keyword If    ${result} != 1    Confirm Delete Campaign
    Go to    ${URL_WMS}/campaign?filter_campaign_type=4
    Input Text    //input[@name='campaign_name']    QA-Robot
    Click Element    //button[@class='btn btn-purple btn-sm']
    Sleep    1s
    ${result}    Execute Javascript    return $('#sample-table-2 > tbody > tr').length
    Run Keyword If    ${result} != 1    Confirm Delete Campaign

Confirm Delete Campaign
    Execute Javascript    $('#check_all').click()
    Execute Javascript    $('.btn-remove-multi').click()
    Sleep    2s
    Confirm Action
    Sleep    5s
    Confirm Action

Reset Test Data Dealzapp
    [Arguments]    ${dealzapp_type}    ${Site}
    ${dealzapp_id}    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Check Current Dealzapp    ELSE    Check Dealzapp Next Day    ${Site}
    ${dealzapp_id}    Remove String    ${dealzapp_id}    row-
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Remove Product from Campaign    ${dealzapp_id}    ${robot_store2_fix_current_deal}    dealzapp    ELSE    Remove Product from Campaign    ${dealzapp_id}    ${robot_store2_fix_next_deal}    dealzapp

Verify Feedback min
    [Documentation]    Verify Feedback min
    ${result}    Execute Javascript    return $('#percent_limit_min').val()
    Should Be True    ${result}    50

Verify Feedback max
    [Documentation]    Verify Feedback max
    ${result}    Execute Javascript    return $('#percent_limit_max').val()
    Should Be True    ${result}    100

Verify Price of discount
    [Documentation]    Verify Price of discount
    ${result}    Execute Javascript    return $('#promotion_amount').val()
    Should Be True    ${result}    ${price_of_discount}

Verify Price of product
    [Documentation]    Verify Price of product
    ${result}    Execute Javascript    return $('#price').val()
    Should Be True    ${result}    ${price_of_product}

Verify Minimum quantity of product
    [Documentation]    Verify Minimum quantity of product
    ${result}    Execute Javascript    return $('#min_quantity').val()
    Should Be True    ${result}    ${min_quantity}

Check Remove Product From Campaign Success
    [Documentation]    Check Remove Product From Campaign Success
    [Arguments]    ${campaign_id}=none    ${product_id}=none    ${campaign_type}=none
    ${result}    Run Keyword And Return Status    Element Should Not Be Visible    //table//tbody[@id='list_product_promotion']//tr//td//a[@ng-href='${URL_LEVEL_D}/${product_id}']
    Run Keyword If    '${result}'=='False'    Remove Product from Campaign    ${campaign_id}    ${product_id}    ${campaign_type}

Create Seo description
    [Documentation]    Create Seo description
    Execute Javascript    $('#mceu_105 > button').click()
    Sleep    1s
    ${file_path}=    Replace String Using Regexp    ${CURDIR}    Keyword$    Image
    ${file_path}=    Remove String    ${file_path}    ${/}Keyword${/}Common
    ${file_path}=    Catenate    SEPARATOR=${/}    ${file_path}${/}Resource/${BU}${/}Configuration${/}${ENV}    html_data.txt
    ${html_desicription}    Get File    ${file_path}
    Execute Javascript    $("textarea[class='mce-textbox mce-multiline mce-abs-layout-item mce-first mce-last']").text('${html_desicription}')
    Execute Javascript    $('button:contains(Ok)').click()

Reset Store/Product Status
    [Arguments]    ${Site}
    Clear Active Login
    Go To Login    ${blockstore_email2}    ${blockstore_password2}
    Go To    ${URL_STORE}/${blockstore_url2}/admin
    #Sleep    3s
    ${check} =    Get Value    //input[@id="openshop_status_old"]
    Run Keyword If    "${check}" == "false"    Execute Javascript    $('#btn_openshop_sidebar').click()
    Go To    ${URL_STORE}/${blockstore_url2}/admin/product
    #Sleep    3s
    Execute Javascript    $('.checkbox-select').click()
    Execute Javascript    $('#btn_visible').click()
    #Sleep    0.5s
    Execute Javascript    $('.btn.btn-primary').click()
    Clear Active Login
    WMS Switch Project    ${Site}
    Change Shop Product Status    shop    ${blockstore_id2}    normal
    Change Shop Product Status    product    ${robot_blockstore2_instock_type_new}    แสดง
    Change Shop Product Status    product    ${robot_blockstore2_instock_type_new}    ผ่านการตรวจสอบ
    Go to    ${URL_PORTAL}

Mobile Reset Store/Product Status
    [Arguments]    ${Site}
    Clear Mobile Login
    Mobile Login    ${blockstore_email3}    ${blockstore_password3}
    Go To    ${URL_STORE}/${blockstore_url3}/admin
    #Sleep    3s
    ${check} =    Get Value    //input[@id="openshop_status_old"]
    Run Keyword If    "${check}" == "false"    Execute Javascript    $('#btn_openshop_sidebar').click()
    Go To    ${URL_STORE}/${blockstore_url3}/admin/product
    #Sleep    3s
    Execute Javascript    $('.checkbox-select').click()
    Execute Javascript    $('#btn_visible').click()
    #Sleep    0.5s
    Execute Javascript    $('.btn.btn-primary').click()
    Clear Mobile Login
    WMS Switch Project    ${Site}
    Change Shop Product Status    shop    ${blockstore_id3}    normal
    Change Shop Product Status    product    ${robot_blockstore3_instock_type_new}    แสดง
    Change Shop Product Status    product    ${robot_blockstore3_instock_type_new}    ผ่านการตรวจสอบ
    Go to    ${URL_PORTAL}

Block Shop
    [Documentation]    Block Shop
    [Arguments]    ${id}    ${status}
    Go to    ${URL_WMS}/blockseller
    Input Text    //input[@name='store_id']    ${id}
    Sleep    0.5s
    Press Key    //input[@name='store_id']    \\13
    Sleep    1.5s
    ${element_id}    Replace String    ${id}    L    store_
    Click Element    //label[@class='position-relative']//span
    Sleep    1.5s
    Select From List By Label    action_block_level    ${status}
    Select From List By Label    action_reason    จัดส่งสินค้าล่าช้า
    Input Text    //input[@name='comment']    change shop status by robot
    Execute Javascript    $('.btn.btn-sm.btn-danger.margin-bottom-5').click()
    Sleep    3

Update status
    [Arguments]    ${status}=On
    Go to    ${URL_WMS}/campaign?filter_campaign_type=price_break
    Element Should Be Visible    //i[contains(@class, "fa-pencil")]
    Click Element    //i[contains(@class, "fa-pencil")]
    Run Keyword If    '${status}' == 'On'    Click Element    //div[contains(@class,"form-group")][1]//div[contains(@class, "col-sm-6")]//label[1]
    Run Keyword If    '${status}' == 'Off'    Click Element    //div[contains(@class,"form-group")][1]//label[2]
    Click Element    //button[@type="submit"]

Check Current Dealzapp
    [Documentation]    Check Current Dealzapp
    Go to    ${URL_WMS}/campaign?filter_campaign_type=5
    ${current_dealzapp}    Set Variable    row-0
    ${current_date}    Get Current Date    UTC    +7 hours    result_format=%d/%m/%Y    exclude_millis=True
    ${current_date_str}    Convert To String    ${current_date}
    ${current_date_str}    Get Substring    ${current_date_str}    \    10
    Select From List By Label    status    On
    Click Element    //button[@type="submit"]
    Sleep    3
    Wait Until Element Is Visible    //table[@id="sample-table-2"]//tr
    ${current_id}    Get Element Attribute    //table[@id='sample-table-2']//tbody//tr[1]@id
    ${current_deal_status}    Run Keyword and Return Status    Element Should Contain    //table[@id='sample-table-2']//tbody//tr[1]//td[5]    ON
    ${current_dealzapp}    Run Keyword If    '${current_deal_status}' == 'True'    Set Variable    ${current_id}
    # ${dealzapp_data}    Get Matching Xpath Count    //table[@id='sample-table-2']//tbody//tr
    # : FOR    ${i}    IN RANGE    1    ${dealzapp_data} + 1
    # \    ${current_id}    Get Element Attribute    //table[@id='sample-table-2']//tbody//tr[${i}]@id
    # \    ${current_deal_status}    Run Keyword and Return Status    Element Should Contain    //table[@id='sample-table-2']//tbody//tr[${i}]//td[5]    ON
    # \    ${current_dealzapp}    Run Keyword If    '${current_deal_status}' == 'True'    Set Variable    ${current_id}
    # \    Run Keyword If    '${current_deal_status}' == 'True'    Exit For Loop
    Set Test Variable    ${current_id}
    [Return]    ${current_dealzapp}

Check Dealzapp Next Day
    [Documentation]    Check Dealzapp Next Day
    [Arguments]    ${Site}
    Go to    ${URL_WMS}/campaign?filter_campaign_type=5
    Run Keyword If    '${Site}' == 'wls'    Input Text    campaign_name    dealzapp
    Run Keyword If    '${Site}' == 'wm'    Input Text    campaign_name    EverydayWoW
    Select From List By Label    status    Pending
    Click Element    //button[@type='submit']
    ${next_dealzapp}    Set Variable    row-0
    ${current_date}    Get Current Date    UTC    +7 hours    result_format=datetime    exclude_millis=True
    ${next_date}    Add Time To Date    ${current_date}    2 days
    ${next_date}    Convert Date    ${next_date}    result_format=%d/%m/%Y
    ${next_date_str}    Convert To String    ${next_date}
    ${next_date_str}    Get Substring    ${next_date_str}    \    10
    ${dealzapp_data}    Get Matching Xpath Count    //table[@id='sample-table-2']//tbody//tr
    : FOR    ${i}    IN RANGE    1    ${dealzapp_data} + 1
    \    ${current_id}    Get Element Attribute    //table[@id='sample-table-2']//tbody//tr[${i}]@id
    \    ${next_deal_status}    Run Keyword and Return Status    Element Should Contain    //table[@id='sample-table-2']//tbody//tr[${i}]//td[5]    PENDING
    \    ${next_dealzapp}    Run Keyword If    '${next_deal_status}' == 'True'    Set Variable    ${current_id}
    \    Run Keyword If    '${next_deal_status}' == 'True'    Exit For Loop
    [Return]    ${next_dealzapp}

Verify product on dealzapp
    [Documentation]    Verify product on dealzapp
    [Arguments]    ${Dealzapp}    # Current or Next
    Log To Console    ${ProductID}
    # Run Keyword If    "${Dealzapp}" == "Next"    Go To    ${URL_PORTAL}/dealzapp?nextdeal=1&refresh=changeme
    # Run Keyword If    "${Dealzapp}" == "Current"    Go To    ${URL_PORTAL}/dealzapp?refresh=changeme
    : FOR    ${i}    IN RANGE    1    10
    \    Run Keyword If    "${Dealzapp}" == "Next"    Go To    ${URL_PORTAL}/dealzapp?nextdeal=1&refresh=changeme
    \    Run Keyword If    "${Dealzapp}" == "Current"    Go To    ${URL_PORTAL}/dealzapp?refresh=changeme
    \    Run Keyword And Ignore Error    Element Should Be Visible    //li//a[@href="${URL_LEVEL_D}/${ProductID}"]    60s
    \    ${CheckProduct}    Get Matching Xpath Count    //li//a[@href="${URL_LEVEL_D}/${ProductID}"]
    \    ${price_status}    Run Keyword And Return Status    Element Should Contain    //li/div/a[contains(.,'${Get_PName}')]//following-sibling::*//span[@class='price']    ${SpecialPrice} บาท
    \    Exit For Loop If    '${CheckProduct}' != '0' and '${price_status}' == 'True'
    Wait Until Page Contains Element    //*[contains(@class,"items-list-box")]
    # : FOR    ${Index}    IN RANGE    0    5
    # \    ${CheckProduct}    Get Matching Xpath Count    //li//a[@href="${URL_LEVEL_D}/${ProductID}"]
    # \    ${price_status}    Run Keyword And Return Status    Element Should Contain    //li[contains(.,'${Get_PName})]//span[@class="price"]    ${SpecialPrice} บาท
    # \    Run Keyword If    '${CheckProduct}' == '0' or '${price_status}' == 'False'    Reload Page
    # \    Exit For Loop If    '${CheckProduct}' != '0' and '${price_status}' == 'True'
    # \    Sleep    5s
    #Page Should Contain Element    //li//a[@href="${URL_LEVEL_D}/${ProductID}"]
    Page Should Contain Element    //li//div[a[@class="item-name" and @href="${URL_LEVEL_D}/${ProductID}"]]//span[@class="price" and contains(.,'${SpecialPrice} ')]
    Run Keyword If    "${Dealzapp}" == "Current"    Page Should Contain Element    timeLayout
    Run Keyword If    "${Dealzapp}" == "Next"    Page Should Not Contain Element    timeLayout
    #Element Text Should Be    //li[1]//span[@class="price"]    ${SpecialPrice} บาท
    Page Should Contain Element    //li//div[a[@class="item-name" and @href="${URL_LEVEL_D}/${ProductID}"]]//span[@class="price" and contains(.,'${SpecialPrice} ')]

Verify product on EverydayWoW
    [Documentation]    Verify product on dealzapp
    [Arguments]    ${Dealzapp}    # Current or Next
    Log To Console    ${ProductID}
    Run Keyword If    "${Dealzapp}" == "Next"    Go To    ${URL_PORTAL}/everyday-wow?nextwow=1&refresh=changeme
    Run Keyword If    "${Dealzapp}" == "Current"    Go To    ${URL_PORTAL}/everyday-wow?refresh=changeme
    : FOR    ${i}    IN RANGE    1    15
    \    Reload Page
    Wait Until Page Contains Element    //*[contains(@class,"items-list-box")]
    : FOR    ${Index}    IN RANGE    0    5
    \    ${CheckProduct}    Get Matching Xpath Count    //li//a[@href="${URL_LEVEL_D}/${ProductID}"]
    \    ${price_status}    Run Keyword And Return Status    Element Should Contain    //li[contains(.,'${Get_PName})]//span[@class="price"]    ${SpecialPrice} บาท
    \    Run Keyword If    '${CheckProduct}' == '0' or '${price_status}' == 'False'    Reload Page
    \    Exit For Loop If    '${CheckProduct}' != '0' and '${price_status}' == 'True'
    \    Sleep    5s
    #Page Should Contain Element    //li//a[@href="${URL_LEVEL_D}/${ProductID}"]
    Page Should Contain Element    //li//div[a[@class="item-name" and @href="${URL_LEVEL_D}/${ProductID}"]]//span[@class="price" and contains(.,'${SpecialPrice} ')]
    Run Keyword If    "${Dealzapp}" == "Current"    Page Should Contain Element    timeLayout
    Run Keyword If    "${Dealzapp}" == "Next"    Page Should Not Contain Element    timeLayout
    #Element Text Should Be    //li[1]//span[@class="price"]    ${SpecialPrice} บาท
    Page Should Contain Element    //li//div[a[@class="item-name" and @href="${URL_LEVEL_D}/${ProductID}"]]//span[@class="price" and contains(.,'${SpecialPrice} ')]


Verify dealzapp on Level D
    [Documentation]    Verify dealzapp on Level D
    [Arguments]    ${Dealzapp}    # Current or Next
    Go To    ${URL_LEVEL_D}/${ProductID}
    Wait Until Page Contains Element    //div[contains(@class,"box-dealzapp")]
    ${TextCheck}    Execute Javascript    return $('.inner-dealzapp').text().trim();
    @{DateCheck}    Execute Javascript    return $('.inner-dealzapp').text().trim().split(" ")
    Run Keyword If    "${Dealzapp}" == "Next"    Should Contain    ${TextCheck}    ราคาพิเศษ ${SpecialPrice} บาท
    Run Keyword If    "${Dealzapp}" == "Current"    Should Contain    ${DateCheck[0]}    เหลือเวลาอีก

Go to dealzapp list
    [Documentation]    Go to dealzapp list
    Go to    ${URL_WMS}/campaign?filter_campaign_type=5
    Wait Until Page Contains Element    sample-table-2

Go to edit dealzapp
    [Documentation]    Go to edit dealzapp
    [Arguments]    ${campaign_id}
    Go to    ${URL_WMS}/campaign/dealzapp/edit/${campaign_id}
    Wait Until Page Contains Element    date_show_campaign

Change dealzapp date to next deal
    [Documentation]    Change dealzapp date to next deal
    [Arguments]    ${campaign_id}=2400
    Go to edit dealzapp    ${campaign_id}
    Switch status campaign    open
    ${Current_Day}    Get Time    day
    ${Next_Day}    Evaluate    ${Current_Day} + 1
    ${Next_2Day}    Evaluate    ${Next_Day} + 1
    Input Text    date_show_campaign    ${Next_Day}/09/2016 10:00 - ${Next_2Day}/09/2016 9:59
    Click submit button
    Set Test Variable    ${campaign_id}    ${campaign_id}

Click submit button
    [Documentation]    Click submit button
    Click Element    //button[@type="submit"]
    Sleep    3s

Filter dealzap status
    [Documentation]    Filter dealzap status
    [Arguments]    ${Status}
    Select From List By Label    status    ${Status}
    Click submit button
    Wait Until Page Contains Element    sample-table-2

Change dealzapp to expire
    [Documentation]    Change dealzapp to expire
    [Arguments]    ${campaign_id}
    Go to edit dealzapp    ${campaign_id}
    Switch status campaign    open
    Input Text    date_show_campaign    01/09/2016 10:00 - 02/09/2016 9:59
    Click submit button

Check no data and get Campaign ID
    [Documentation]    Check no data and get Campaign ID
    ${NoData_msg}    Get Matching Xpath Count    //td[contains(.,'--- No data ---')]
    ${campaign_id}    Execute Javascript    return $('td input:eq(0)').attr('value');
    [Return]    ${NoData_msg}    ${campaign_id}

Go to Manage Show
    [Documentation]    Go to Manage Show
    [Arguments]    ${campaign_id}
    Go to    ${URL_WMS}/campaign/dealzapp/manage-show/${campaign_id}
    Wait Until Page Contains Element    //*[@ng-repeat="product in filterProduct.data"]

Save Manage shop
    [Documentation]    Save Manage shop
    Wait Until Page Contains Element    //*[@ng-click="saveAtion()"]//i
    Click Element    //*[@ng-click="saveAtion()"]//i
    Sleep    2
    Wait Until Page Does Not Contain Element    //*[@ng-click="saveAtion()"]//i

Verify Collection on dealzapp
    [Documentation]    Verify Collection on dealzapp
    [Arguments]    ${dealzapp_type}
    : FOR    ${i}    IN RANGE    1    11
    \    ${text1}=    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Get Text    //*[@id="list_product_promotion"]/tr[${i}]/td[10]/span
    \    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Should Contain    ${text1}    ราคาเดียว 99 บา..
    \    ${text2}=    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Get Text    //*[@id="list_product_promotion"]/tr[${i}]/td[10]/span
    \    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Should Contain    ${text2}    Best Gadget
    : FOR    ${i}    IN RANGE    16    21
    \    ${text3}=    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Get Text    //*[@id="list_product_promotion"]/tr[${i}]/td[10]/span
    \    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Should Contain    ${text3}    บาทเดียวทุกชิ้น
    \    ${text4}=    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Get Text    //*[@id="list_product_promotion"]/tr[${i}]/td[10]/span
    \    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Should Contain    ${text4}    Best Sport ware

Set Collection to Product
    [Documentation]    Set Collection to Product
    [Arguments]    ${dealzapp_id}    ${dealzapp_type}
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn ' and contains(text(),'Deal Zapp')]
    Sleep    1s
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > button').click()
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > ul > li:contains(Edit) > a')[0].click()
    Sleep    3s
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='productMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='showInCampaignMsg']
    Assign Id To Element    //select[@class='form-control ng-pristine ng-untouched ng-valid ng-scope']    collection_list
    : FOR    ${i}    IN RANGE    0    10
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select From List By Label    collection_list    ราคาเดียว 99 บา..
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select From List By Label    collection_list    Best Gadget
    Execute Javascript    $('button:contains(Apply)').click()
    : FOR    ${i}    IN RANGE    0    10
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    : FOR    ${i}    IN RANGE    15    20
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select From List By Label    collection_list    บาทเดียวทุกชิ้น
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select From List By Label    collection_list    Best Sport ware
    Execute Javascript    $('button:contains(Apply)').click()
    : FOR    ${i}    IN RANGE    15    20
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    Execute Javascript    $('.navbar-btn').click()
    Sleep    3s
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='showInCampaignMsg']

[Wemall] Set Collection to Product
    [Documentation]    Set Collection to Product
    [Arguments]    ${dealzapp_id}    ${dealzapp_type}
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn ' and contains(text(),'Deal Zapp')]
    Sleep    1s
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > button').click()
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > ul > li:contains(Edit) > a')[0].click()
    Sleep    3s
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='productMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='showInCampaignMsg']
    Assign Id To Element    //select[@class='form-control ng-pristine ng-untouched ng-valid ng-scope']    collection_list
    : FOR    ${i}    IN RANGE    0    10
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select From List By Label    collection_list    ราคาเดียว 99 บา..
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select From List By Label    collection_list    Best Gadget
    Execute Javascript    $('button:contains(Apply)').click()
    : FOR    ${i}    IN RANGE    0    10
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    : FOR    ${i}    IN RANGE    15    20
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select From List By Label    collection_list    บาทเดียวทุกชิ้น
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select From List By Label    collection_list    Best Sport ware
    Execute Javascript    $('button:contains(Apply)').click()
    : FOR    ${i}    IN RANGE    15    20
    \    Execute Javascript    $("input[ng-checked='product.checked']")[${i}].click()
    Execute Javascript    $('.navbar-btn').click()
    Sleep    3s
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Not Visible    //span[@ng-if='showInCampaignMsg']

Open and Prepare Data
    Open Custom Browser    ${URL_PORTAL}    ${BROWSER}

Clear All Test
    Close All Browsers

Set Dealzapp Product
    [Documentation]    Set Dealzapp Product
    [Arguments]    ${dealzapp_type}    ${dealzapp_id}
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn ' and contains(text(),'Deal Zapp')]
    Sleep    1s
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > button').click()
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > ul > li:contains(Edit) > a')[0].click()
    Sleep    3s
    Wait Until Element Is Visible    //span[@class='badge badge-success ng-binding ng-scope']    60s
    ${current_product}    Get Text    //span[@class='badge badge-success ng-binding ng-scope']
    Run Keyword If    '${current_product}' != 'Public 0/0'    Execute Javascript    $('.all_check.ng-pristine.ng-untouched.ng-valid')[1].click()
    Run Keyword If    '${current_product}' != 'Public 0/0'    Click Element    //button[@class='btn btn-sm btn-danger' and contains(text(),'Move Back')]
    Run Keyword If    '${current_product}' != 'Public 0/0'    Execute Javascript    $('.btn.btn-warning.navbar-btn.ng-binding').click()
    Sleep    3s
    Wait Until Element Is Visible    //span[@class='badge badge-success ng-binding ng-scope']    60s
    ${dealzapp_id}    Remove String    ${dealzapp_id}    row-
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_fashion}    other
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_beauty}    other
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_mobile}    other
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_product}
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select Product to Campaign    ${dealzapp_id}    ${next_deal_beauty}    other
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select Product to Campaign    ${dealzapp_id}    ${next_deal_product}

[Wemall] Set Dealzapp Product
    [Documentation]    Set Dealzapp Product
    [Arguments]    ${dealzapp_type}    ${dealzapp_id}
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn ' and contains(text(),'Deal Zapp')]
    Sleep    1s
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > button').click()
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('div > ul > li:contains(Edit) > a')[0].click()
    Sleep    3s
    Wait Until Element Is Visible    //span[@class='badge badge-success ng-binding ng-scope']    60s
    ${current_product}    Get Text    //span[@class='badge badge-success ng-binding ng-scope']
    Run Keyword If    '${current_product}' != 'Public 0/0'    Execute Javascript    $('.all_check.ng-pristine.ng-untouched.ng-valid')[1].click()
    Run Keyword If    '${current_product}' != 'Public 0/0'    Click Element    //button[@class='btn btn-sm btn-danger' and contains(text(),'Move Back')]
    Run Keyword If    '${current_product}' != 'Public 0/0'    Execute Javascript    $('.btn.btn-warning.navbar-btn.ng-binding').click()
    Sleep    3s
    Wait Until Element Is Visible    //span[@class='badge badge-success ng-binding ng-scope']    60s
    ${dealzapp_id}    Remove String    ${dealzapp_id}    row-
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_fashion}    other
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_beauty}    other
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_mobile}    other
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Select Product to Campaign    ${dealzapp_id}    ${current_deal_product}
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select Product to Campaign    ${dealzapp_id}    ${next_deal_beauty}    other
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Select Product to Campaign    ${dealzapp_id}    ${next_deal_product}

Set Collection to Dealzapp
    [Documentation]    Set Collection to Dealzapp
    [Arguments]    ${dealzapp_id}    ${dealzapp_type}
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn ' and contains(text(),'Deal Zapp')]
    Sleep    1s
    Execute Javascript    $('#${dealzapp_id} > td').eq(5).find('span').click()
    Sleep    0.5s
    ${current_collection}    Execute Javascript    return $('.red.btn-remove').length
    : FOR    ${i}    IN RANGE    0    ${current_collection}
    \    ${current_collection}    Evaluate    ${current_collection} - 1
    \    Execute Javascript    $('.red.btn-remove')[${current_collection}].click()
    \    Confirm Action
    Run Keyword If    '${dealzapp_type}' == 'current_deal'    Add Collection to Current Dealzapp
    Run Keyword If    '${dealzapp_type}' == 'next_deal'    Add Collection to Next Dealzapp

Add Collection to Current Dealzapp
    [Documentation]    Add Collection to Current Dealzapp
    Click Element    //div//a[@id='add_collection']
    Execute Javascript    $('.required').eq(0).val("ราคาเดียว 99 บาท")
    Click Element    //a[@id='add_collection']
    Execute Javascript    $('.required').eq(1).val("บาทเดียวทุกชิ้น")
    Click Element    //button[@class='btn btn-info btn-submit']

Add Collection to Next Dealzapp
    [Documentation]    Add Collection to Next Dealzapp
    Click Element    //div//a[@id='add_collection']
    Execute Javascript    $('.required').eq(0).val("Best Gadget")
    Click Element    //a[@id='add_collection']
    Execute Javascript    $('.required').eq(1).val("Best Sport ware")
    Click Element    //button[@class='btn btn-info btn-submit']

Select Product to Campaign
    [Documentation]    Select Product to Campaign
    [Arguments]    ${campaign_id}=none    ${product}=none    ${type}=none
    Run Keyword If    '${type}' == 'promotion' or '${type}' == 'promotion_type3'    Go to    ${URL_WMS}/campaign/promotion/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'none_join'    Go to    ${URL_WMS}/campaign/collection-non-join/manage-show/${campaign_id}
    Run Keyword If    '${type}' == 'flashsale' or '${type}' == 'none' or '${type}' == 'other'    Go to    ${URL_WMS}/campaign/dealzapp/manage-show/${campaign_id}
    Sleep    3s
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='productMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='showInCampaignMsg']
    Execute Javascript    $("input[name='txt_search_product']").val('${product}')
    Press Key    //input[@name='txt_search_product']    \\13
    Sleep    3s
    ${product_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='productMsg']
    Run Keyword If    '${product_load}'=='True'    Wait Until Page Does Not Contain Element    //span[@ng-if='productMsg']
    ${campaign_load}    Run Keyword and Return Status    Element Should Be Visible    //span[@ng-if='showInCampaignMsg']
    Run Keyword If    '${campaign_load}'=='True'    Wait Until Element Is Visible    //span[@ng-if='publicItem']
    Execute Javascript    $('.all_check.ng-pristine.ng-untouched.ng-valid')[0].click()
    Click Element    //button[@class='btn btn-sm btn-primary pull-right']
    Sleep    3s
    Run Keyword If    '${type}'=='none'    Set Custom Price and Limit FlashSale
    Run Keyword If    '${type}'=='flashsale'    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[8]//input    99
    Run Keyword If    '${type}'=='promotion_type3'    Input Text    //tbody[@id='list_product_promotion']//tr[1]//td[8]//input    99
    Sleep    1s
    Execute Javascript    $('.btn.btn-warning.navbar-btn.ng-binding').click()
    Sleep    2s
    Wait Until Element Is Visible    //span[@ng-if='publicItem']    ${EXPECT_LOADTIME}

Set Custom Price and Limit FlashSale
    [Documentation]    Set Custom Price and Limit FlashSale
    ${count_product}=    Execute Javascript    return $('#list_product_promotion > tr').length
    # ${count_product}=    Evaluate    ${count_product} - 3
    ${count_product}    Set Variable If    ${count_product} > 8    8    ${count_product}
    : FOR    ${i}    IN RANGE    0    ${count_product}
    \    ${index}=    Evaluate    ${i} + 1
    \    ${random}=    Evaluate    ${index} % 2
    \    Run Keyword If    ${random} == 0    Input Text    //tbody[@id='list_product_promotion']//tr[${index}]//td[8]//input    299
    \    Run Keyword If    ${random} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[${index}]//td[8]//input    399
    \    Run Keyword If    ${random} == 0    Input Text    //tbody[@id='list_product_promotion']//tr[${index}]//td[9]//input    2
    \    Run Keyword If    ${random} != 0    Input Text    //tbody[@id='list_product_promotion']//tr[${index}]//td[9]//input    3
    [return]    ${count_product}

Dealzapp Edit
    [Arguments]    ${type}    ${dealzapp_id}    ${Site}
    ${current_date}    Get Current Date    UTC    +7 hours    result_format=datetime    exclude_millis=True
    ${next_date}    Add Time To Date    ${current_date}    2 days
    ${next2_date}    Add Time To Date    ${next_date}    2 days
    ${current_date}    Convert Date    ${current_date}    result_format=%d/%m/%Y
    ${current_date_str}    Convert To String    ${current_date}
    ${current_date_str}    Get Substring    ${current_date_str}    \    10
    ${next_date}    Convert Date    ${next_date}    result_format=%d/%m/%Y
    ${next_date_str}    Convert To String    ${next_date}
    ${next_date_str}    Get Substring    ${next_date_str}    \    10
    ${next2_date}    Convert Date    ${next2_date}    result_format=%d/%m/%Y
    ${next2_date_str}    Convert To String    ${next2_date}
    ${next2_date_str}    Get Substring    ${next2_date_str}    \    10
    ${dealzapp_id}    Remove String    ${dealzapp_id}    row-
    Go to    ${URL_WMS}/campaign/dealzapp/edit/${dealzapp_id}
    Run Keyword If    '${type}' == 'current_deal' and '${Site}' == 'wls'    Execute Javascript    $('#campaign_name_th').val('Dealzapp : ${current_date_str}');
    Run Keyword If    '${type}' == 'next_deal' and '${Site}' == 'wls'    Execute Javascript    $('#campaign_name_th').val('Dealzapp : ${next_date_str}');
    Run Keyword If    '${type}' == 'current_deal' and '${Site}' == 'wm'    Execute Javascript    $('#campaign_name_th').val('EverydayWoW : ${current_date_str}');
    Run Keyword If    '${type}' == 'next_deal' and '${Site}' == 'wm'    Execute Javascript    $('#campaign_name_th').val('EverydayWoW : ${next_date_str}');
    Run Keyword If    '${type}' == 'current_deal'    Execute Javascript    $('#date_show_campaign').val('${current_date_str} 10:00 - ${next_date_str} 09:59');
    Run Keyword If    '${type}' == 'next_deal'    Execute Javascript    $('#date_show_campaign').val('${next_date_str} 10:00 - ${next2_date_str} 09:59');
    Execute Javascript    $('form').submit();
    Sleep    3s

Cancel All Product To join Campaign
    [Documentation]    Select All Product to cancel join campaign
    Execute Javascript    $('input[id="check_all2"]').click()
    Execute Javascript    $('button[id="del-product"]').click()
    Execute Javascript    $('button[id="btn_create"]').click()
    Execute Javascript    $(':contains("ตกลง")').click()
    Sleep    2s
    Click Element    //button[@id="btn_create_cat2"]

Select Product To join Campaign
    [Documentation]    Select 1 Product to join Campign
    [Arguments]    ${product_id}
    ${product_id}    Remove String    ${product_id}    L
    ${status}    Run Keyword And Return Status    Element Should Be Visible    ${btn_pagination_camapaign}
    Run Keyword If    '${status}' == 'True'    Run Keywords    Click Element    ${btn_pagination_camapaign}    AND    Execute Javascript    $("input[value='${product_id}']").click()
    Run Keyword If    '${status}' == 'False'    Execute Javascript    $("input[value='${product_id}']").click()
    Click Element    ${btn_select_product}
    Click Element    ${btn_save_campaign}

WLS Approve Product
    [Documentation]    WLS Approve Product
    [Arguments]    ${campaign_type}=none    ${campaign_id}=none    ${product_id}=none    ${action}=monitor    ${duplicate_period}=no
    Log To Console    ${\n}Arguments Data : ${campaign_type} | ${campaign_id} | ${product_id} | ${action} | ${duplicate_period}
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/approve/${campaign_id}
    ...    ELSE    Go to    ${URL_WMS}/campaign/promotion/approve/${campaign_id}
    Assign Id To Element    //*[@id="row-${product_id}"]/td[14]/select    approve_status
    Run Keyword If    '${action}' == 'approve'    Select From List By Label    approve_status    Approve
    ${product_status}    Execute Javascript    return $("tr[id='row-${product_id}'] > td").eq(13).find('select option:selected').text()
    Run Keyword If    '${action}' == 'monitor'    Should Be True    '${product_status}' == 'Waiting'
    Run Keyword If    '${action}' == 'approve'    Should Be True    '${product_status}' == 'Approve'
    Run Keyword If    '${action}' == 'approve'    WMS Verify Product After Approved    ${campaign_type}    ${campaign_id}    ${product_id}

WMS Verify Product After Approved
    [Documentation]    WMS Verify Product After Approved
    [Arguments]    ${campaign_type}=none    ${campaign_id}=none    ${product_id}=none
    Run Keyword If    '${campaign_type}' == 'join'    Go to    ${URL_WMS}/campaign/collection-join/manage-show/${campaign_id}
    ...    ELSE    Go to    ${URL_WMS}/campaign/promotion/manage-show/${campaign_id}
    Wait Until Element Is Visible    //span[@class='badge badge-success ng-binding ng-scope']    60s
    ${count_product}    Get Matching Xpath Count    //tbody[@id='list_product_promotion']//tr
    ${index_row}    Set Variable    1
    : FOR    ${i}    IN RANGE    1    ${count_product} + 1
    \    Wait Until Element Is Visible    //tbody[@id='list_product_promotion']//tr[${i}]//td[3]//a[@href='${URL_LEVEL_D}/${product_id}']    60s
    \    ${result}    Run Keyword And Return Status    Element Should Be Visible    //tbody[@id='list_product_promotion']//tr[${i}]//td[3]//a[@href='${URL_LEVEL_D}/${product_id}']
    \    ${index_row}    Run Keyword If    '${result}' == 'True'    Set Variable    ${i}    ELSE    Set Variable    1
    \    Run Keyword If    '${result}' == 'True'    Exit FOR Loop
    Element Should Be Visible    //tbody[@id='list_product_promotion']//tr[${index_row}]//td[3]//a[@href='${URL_LEVEL_D}/${product_id}']

Create Dealzapp
    [Documentation]    Create Dealzapp
    [Arguments]    ${type}    ${Site}
    ${current_date}    Get Current Date    UTC    +7 hours    result_format=datetime    exclude_millis=True
    ${next_date}    Add Time To Date    ${current_date}    2 days
    ${next2_date}    Add Time To Date    ${next_date}    2 days
    ${current_date}    Convert Date    ${current_date}    result_format=%d/%m/%Y
    ${current_date_str}    Convert To String    ${current_date}
    ${current_date_str}    Get Substring    ${current_date_str}    \    10
    ${next_date}    Convert Date    ${next_date}    result_format=%d/%m/%Y
    ${next_date_str}    Convert To String    ${next_date}
    ${next_date_str}    Get Substring    ${next_date_str}    \    10
    ${next2_date}    Convert Date    ${next2_date}    result_format=%d/%m/%Y
    ${next2_date_str}    Convert To String    ${next2_date}
    ${next2_date_str}    Get Substring    ${next2_date_str}    \    10
    WMS Switch Project    ${Site}
    Go to    ${URL_WMS}/campaign
    Click Element    //button[@class='btn btn-sm btn-info' and contains(text(),'+ Deal Zapp')]
    Run Keyword If    '${type}' == 'current_deal' and '${Site}' == 'wls'    Execute Javascript    $('#campaign_name_th').val('Dealzapp : ${current_date_str}');
    Run Keyword If    '${type}' == 'next_deal' and '${Site}' == 'wls'    Execute Javascript    $('#campaign_name_th').val('Dealzapp : ${next_date_str}');
    Run Keyword If    '${type}' == 'current_deal' and '${Site}' == 'wm'    Execute Javascript    $('#campaign_name_th').val('EverydayWoW : ${current_date_str}');
    Run Keyword If    '${type}' == 'next_deal' and '${Site}' == 'wm'    Execute Javascript    $('#campaign_name_th').val('EverydayWoW : ${next_date_str}');
    ${FILE_DIR}=    Replace String    ${CURDIR}    ${/}Keyword${/}Common    ${/}Resource${/}${BU}
    Choose File    id=file_banner    ${FILE_DIR}/Image/banner.jpg
    Choose File    id=file_topbanner    ${FILE_DIR}/Image/banner.jpg
    Choose File    id=file_bannermobile    ${FILE_DIR}/Image/banner.jpg
    Run Keyword If    '${type}' == 'current_deal'    Execute Javascript    $('#date_show_campaign').val('${current_date_str} 10:00 - ${next_date_str} 09:59');
    Run Keyword If    '${type}' == 'next_deal'    Execute Javascript    $('#date_show_campaign').val('${next_date_str} 10:00 - ${next2_date_str} 09:59');
    Select Frame    id=description_th_ifr
    Input Text    //body[@id='tinymce']    Dealzapp create by robot script !!
    Unselect Frame
    Create Seo description
    Execute Javascript    $("input[name='order_product']")[1].click()
    Execute Javascript    $('form').submit();
    Sleep    3s

Get Start-End Date
    [Arguments]    ${EndDate}=2
    ${campaign_lastest_start}=    Execute Javascript    return $('#sample-table-2 tr:first-child td').eq(3).text().trim().replace('Start:','').replace('End:','').trim().split(' ')[0]
    ${campaign_lastest_start}    Convert Date    ${campaign_lastest_start}    exclude_millis=yes    date_format=%d/%m/%Y
    ${next_date_start}    Add Time To Date    ${campaign_lastest_start}    2 day    result_format=%d/%m/%Y
    ${CArray}=    Execute Javascript    return $('#sample-table-2 tr:first-child td').eq(3).text().trim().replace('Start:','').replace('End:','').trim().split(' ').length-2;
    ${campaign_lastest_end}=    Execute Javascript    return $('#sample-table-2 tr:first-child td').eq(3).text().trim().replace('Start:','').replace('End:','').trim().split(' ')[${CArray}].trim()
    ${campaign_lastest_end}    Convert Date    ${campaign_lastest_end}    exclude_millis=yes    date_format=%d/%m/%Y
    ${next_date_end}    Add Time To Date    ${campaign_lastest_end}    ${EndDate} day    result_format=%d/%m/%Y
    Set Test Variable    ${next_date_start}
    Set Test Variable    ${next_date_end}

Upload Photo
    ${FilePath}    Replace String    ${CURDIR}    ${/}Keyword${/}Common    ${/}Resource${/}${BU}
    Choose File    id=file_banner    ${FilePath}${/}Image${/}join_top_banner.jpg
    Choose File    id=file_topbanner    ${FilePath}${/}Image${/}join_top_banner.jpg
    Choose File    id=file_bannermobile    ${FilePath}${/}Image${/}join_top_banner.jpg

Go To DealZapp
    Go To    ${URL_WMS}/campaign?filter_campaign_type=5

Go To Create DealZapp
    Go To    ${URL_WMS}/campaign/dealzapp/create

Verify After Save Unsuccess
    Location Should Be    ${URL_WMS}/campaign/dealzapp/create

Input Campaign Fee
    Execute Javascript    $('input[name=price_fee]').val(3).click();

Verify DealZapp After Update
    [Arguments]    ${DealZapp_Name}
    Wait Until Element Is Visible    //*[@id="sample-table-2"]
    ${campaign_name}    Execute Javascript    return $('#sample-table-2 > tbody > tr').eq(0).find("td").eq(2).text()
    Should be true    "${campaign_name}" == "${DealZapp_Name}"

Get DealZapp Product
    [Documentation]    Get DealZapp Product
    [Arguments]    ${product_name}
    Execute Javascript    $('.group-lvc-menu-list .option-wetrust').eq(1).find('.checkbox:contains("แฟชั่น") input').click();
    Wait Until Element Is Visible    ${active_dealzapp}//div[3]//div[2]//ul[1]//li//a[contains(text(),'${product_name}')]    10s
    Focus    ${active_dealzapp}//div[3]//div[2]//ul[1]//li//a[contains(text(),'${product_name}')]
    Click Element    ${active_dealzapp}//div[3]//div[2]//ul[1]//li//a[contains(text(),'${product_name}')]

Validate JoinCampaign View Pages
    Element Should Be Disabled    //*[@name="campaign_status"]
    Element Should Be Disabled    //*[@name="campaign_show"]
    Element Should Be Disabled    //*[@name="campaign_fee"]
    Element Should Be Disabled    //*[@id="campaign_name_th"]
    Element Should Be Disabled    //*[@id="file_banner"]
    Element Should Be Disabled    //*[@id="file_topbanner"]
    Element Should Be Disabled    //*[@id="link_banner"]
    Element Should Be Disabled    //*[@id="file_bannermobile"]
    Element Should Be Disabled    //*[@id="link_banner_mobile"]
    Element Should Be Disabled    //*[@id="campaign_group_id"]
    Element Should Be Disabled    //*[@name="discount_type"]
    Element Should Be Disabled    //*[@name="has_feedback_limit"]
    Element Should Be Disabled    //*[@name="date_join_campaign"]
    Element Should Be Disabled    //*[@name="date_show_campaign"]
    Element Should Be Disabled    //*[@name="product_type"]
    Element Should Be Disabled    //*[@id="min_quantity"]
    Element Should Be Disabled    //*[@name="order_product"]
    Element Should Be Disabled    //*[@id="slug_th"]

Verify Price Fee
    [Documentation]    Verify Price Fee
    [Arguments]    ${price_fee}
    ${result}    Execute Javascript    return $('#price_fee').val()
    Should Be True    ${result} == ${price_fee}

Verify Product In Cmmpaign
    [Arguments]    ${name}    ${stock}    ${feedback}    ${discount}    ${sla}    ${max_capa}    ${price}    ${limit}
    Element Should Contain    //*[@id="list_product_promotion"]/tr/td[3]/a    ${name}
    Element Should Contain    //*[@id="list_product_promotion"]/tr/td[4]    ${stock}
    Element Should Contain    //*[@id="list_product_promotion"]/tr/td[5]    ${feedback}
    Element Should Contain    //*[@id="list_product_promotion"]/tr/td[6]    ${discount}
    Element Should Contain    //*[@id="list_product_promotion"]/tr/td[7]    ${sla}
    Element Should Contain    //*[@id="list_product_promotion"]/tr/td[8]    ${max_capa}
    Element Should Contain    //*[@id="list_product_promotion"]/tr/td[9]    ${price}
    Textfield Value Should Be    //*[@id="list_product_promotion"]/tr/td[10]/input    ${limit}

Clear Pending
    Select From List By Label    status    Pending
    Click Element    //button[@type="submit"]
    Sleep    2
    Wait Until Element Is Visible    //table[@id="sample-table-2"]//tr
    ${CountPending}    Check Pending
    ${campaign_name}    Execute Javascript    return $('#sample-table-2 > tbody > tr').eq(0).find("td").eq(2).text()
    ${status}    Run Keyword And Return Status    Should Contain Any    ${campaign_name}    EverydayWoW    Dealzapp    ignore_case=True
    Run Keyword If    "${CountPending}" != "0" and '${status}' == 'False'   Change Pending To Expire

Check Pending
    ${CountPending}    Get Matching Xpath Count    //span[contains(.,'PENDING')]
    [Return]    ${CountPending}

Change Pending To Expire
    Click Element    //i[@class="ace-icon fa fa-pencil bigger-130"]
    Wait Until Element Is Visible    date_show_campaign
    Input Text    date_show_campaign    01/05/2017 10:00 - 03/05/2017 09:59
    Click Element    //button[@type="submit"]

Verify Campaign Status
    [Arguments]    ${status}
    Run Keyword if   '${status}' == 'ON'    Element Should Be Visible    //div[contains(@class, 'box-campaign-detail')]
    Run Keyword if   '${status}' == 'OFF'    Element Should Be Visible    //div[contains(@class, 'box-no-result')]


##HOME EVERYDAY WOW AND LEVELC EVERYDAY WOW
Open Wemall Portal page on Desktop
    Go to    ${URL_PORTAL}

Go To LevelC Everyday WOW NOW
    Go to    ${URL_PORTAL}/everyday-wow

Go To LevelC Everyday WOW NEXT
    Go to    ${URL_PORTAL}/everyday-wow?nextwow=1

Focus Box Home Everyday WOW
    Wait Until Element Is Visible    ${box_home_everydaywow}

Click Icon Everyday WOW
    Click Element    ${img_home_icon_everydaywow}
    Wait Until Element Is Visible    ${product_all_lvc_everydaywow}

Click Link Everyday WOW
    Click Element    ${lnk_home_link_everydaywow}
    Wait Until Element Is Visible    ${product_all_lvc_everydaywow}

Click Link Everyday WOW Production
    Click Element    ${lnk_home_link_everydaywow_prod}
    Wait Until Element Is Visible    ${product_all_lvc_everydaywow}

Focus Mainmenu Everyday WOW
    Wait Until Element Is Visible    ${mainmenu_home_everydaywow}

Click Mainmenu Everyday WOW
    Click Element    ${mainmenu_home_everydaywow}
    Wait Until Element Is Visible    ${product_all_lvc_everydaywow}

Sort Product by Percent Discount
    Click Element   ${sorting_everydaywow}
    Click Element   ${sorting_everydaywow_discountpercent}

Products should be sorted by percent discount
    : FOR    ${i}    IN RANGE    1    4
    \    ${percent_now}    Get Text    //li[${i}]${bagde_percent_discount}
    \    ${i_next}    Add Operation    ${i}    1
    \    ${percent_next}    Get Text    //li[${i_next}]${bagde_percent_discount}
    \    Should Be True    ${percent_now} >= ${percent_next}

Sort Product by lowest price
    Click Element   ${sorting_everydaywow}
    Click Element   ${sorting_everydaywow_lowprice}

Products should be sorted by lowest price
    ${checkdeal}    Get Text    //a[@class="dz-tab active "]
    ${checkdeal}    Remove String    ${checkdeal}    ${SPACE}
    Run Keyword IF    '${checkdeal}' == 'NowWOW'    sorted price by lowest price
    Run Keyword IF    '${checkdeal}' == 'NextWOW'    sorted compareprice by lowest price
    [Return]    ${checkdeal}

sorted price by lowest price
    : FOR    ${i}    IN RANGE    1    4
    \    ${price_now}    Get Text    //li[${i}]${price_everydaywow}
    \    ${i_next}    Add Operation    ${i}    1
    \    ${price_next}    Get Text    //li[${i_next}]${price_everydaywow}
    \    ${price_now}    Remove String    ${price_now}    บาท
    \    ${price_next}    Remove String    ${price_next}    บาท
    \    Should Be True    ${price_now} <= ${price_next}

sorted compareprice by lowest price
    : FOR    ${i}    IN RANGE    1    4
    \    ${price_now}    Get Text    //li[${i}]${compareprice_everydaywow}
    \    ${i_next}    Add Operation    ${i}    1
    \    ${price_next}    Get Text    //li[${i_next}]${compareprice_everydaywow}
    \    ${price_now}    Remove String    ${price_now}    บาท
    \    ${price_next}    Remove String    ${price_next}    บาท
    \    Should Be True    ${price_now} <= ${price_next}

Sort Product by Highest Price
    Click Element   ${sorting_everydaywow}
    Click Element   ${sorting_everydaywow_highestprice}

Products should be sorted by higest price
    : FOR    ${i}    IN RANGE    1    4
    \    ${price_now}    Get Text    //li[${i}]${price_everydaywow}
    \    ${i_next}    Add Operation    ${i}    1
    \    ${price_next}    Get Text    //li[${i_next}]${price_everydaywow}
    \    ${price_now}    Remove String    ${price_now}    บาท
    \    ${price_next}    Remove String    ${price_next}    บาท
    \    Should Be True    ${price_now} >= ${price_next}

Select Category On Everyday WOW
    Wait Until Element Is Visible    ${product_all_lvc_everydaywow}
    Element Should Be Visible    ${nav_left_menu_everydaywow}
    Execute Javascript    ${chk_category1}
    Execute Javascript    ${chk_category2}

De select Category On Everyday WOW
    Element Should Be Visible    ${nav_left_menu_everydaywow}
    Execute Javascript    ${chk_category1}
    Execute Javascript    ${chk_category2}

Remove Option On Everyday WOW
    Element Should Be Visible    ${option_list}
    Execute Javascript    ${remove_option}

Clear All Option On Everyday WOW
    Element Should Be Visible    ${option_list}
    Mouse Over    ${btn_clear_all_option}
    Click Element    ${btn_clear_all_option}

Delete Robot Dealzapp
    [Arguments]    ${name}    ${campaign_status}=Expired
    Go to    ${URL_WMS}/campaign?filter_campaign_type=5
    Input Text    //input[@name='campaign_name']    ${name}
    Select From List By Label    id=status    ${campaign_status}
    Click Element    //button[@class='btn btn-purple btn-sm']
    Sleep    1s
    ${result}    Execute Javascript    return $('#sample-table-2 > tbody > tr').length
    Run Keyword If    ${result} != 0    Confirm Delete Campaign

Go To Wemall Homepage
    Wait Until Element Is Visible    ${img_home_icon_everydaywow}
    Element Should Be Visible    ${img_home_icon_everydaywow}
    Element Should Be Visible    ${obj_first_flashsale_item}

Go To Wemall Production Homepage
    Go To    ${URL_SHOP}
    Wait Until Element Is Visible    ${img_home_icon_everydaywow_prod}
    Element Should Be Visible    ${img_home_icon_everydaywow_prod}
    Element Should Be Visible    ${obj_first_flashsale_item}

Check The Product In Everyday WOW
    Wait Until Element Is Visible    ${lbl_header_campaignname}
    Element Should Be Visible    ${obj_everydaywow_item}

Go To Next Wow
    Wait Until Element Is Visible    ${lbl_header_campaignname}
    Click Element    ${tab_next_wow}
    Wait Until Element Is Visible    ${lbl_countdown}
    ${message}    Get Text    ${lbl_countdown}
    Should Be Equal    ${message}    ช้อปสินค้าใหม่พร้อมกันเริ่มเวลา10 : 00น.

Go To Next Wow Production
    Wait Until Element Is Visible    ${lbl_header_campaignname}
    Click Element    ${tab_next_wow_prod}
    Wait Until Element Is Visible    ${lbl_countdown}
    ${message}    Get Text    ${lbl_countdown}
    Should Be Equal    ${message}    ช้อปสินค้าใหม่พร้อมกันเริ่มเวลา10 : 00น.

Check The Product In Next WOW
    Element Should Be Visible    ${obj_nextwow_item}

Go To WMS Campaign Admin Tools (Store)
    Go to    ${URL_WMS}/campaignadmin_store

Check Store Id Record Display Product
    [Arguments]    ${locator}    ${store_id}
    ${new}    Replace String    ${locator}    _replace_    ${store_id}
    Element Should Be Visible    ${new}

Check Store Name Record Display
    [Arguments]    ${store_name}
    Element Should Contain    ${lbl_store_name}    ${store_name}

Go To Join Campaign
    Go to    ${URL_WMS}/${tab_join_campaign}

Go To Manage Product Join Campaign
    [Arguments]    ${campaign_id}
    ${manageshow}    Replace String    ${tab_manageshow_join_campaign}    -id    ${campaign_id}
    Go To    ${URL_WMS}/${manageshow}

Search Product ID
    [Arguments]    ${productid}
    Wait Until Element Is Visible    ${lbl_productid_serach}
    Input Text    ${lbl_productid_serach}    ${productid}
    Press Key    ${lbl_productid_serach}    \\13

Verify Search Product ID
    Wait Until Element Is Visible    ${tbc_product}

Go To Manage Product NoneJoinCampaign
    [Arguments]    ${campaign_id}
    ${manageshow}    Replace String    ${tab_dealzapp}    -id    ${campaign_id}
    Go To    ${URL_WMS}/${manageshow}

Click Manage Show
    Click Element    ${btn_manageshow}
    Click Element    ${lbl_edit}

Go To Manage Product WLSPromotion
    [Arguments]    ${campaing_id}
    ${manageshow}    Replace String    campaign/promotion/manage-show/-id    -id    ${campaing_id}
    Go To    ${URL_WMS}/${manageshow}
